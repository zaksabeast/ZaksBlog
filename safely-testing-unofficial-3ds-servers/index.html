<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/ZaksBlog/styles.7e71967fcf2eddb08c88.css">body{margin:0}</style><meta name="generator" content="Gatsby 2.18.12"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script>
  
  function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='UA-113145419-3',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
  if(!(parseInt(navigator.doNotTrack) === 1 || parseInt(window.doNotTrack) === 1 || parseInt(navigator.msDoNotTrack) === 1 || navigator.doNotTrack === "yes")) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-113145419-3', 'auto', {});
      ga('set', 'anonymizeIp', true);
      
      
      
      
      }</script><title data-react-helmet="true">Safely testing unofficial 3ds servers</title><meta data-react-helmet="true" name="viewport" content="minimum-scale=1, initial-scale=1, width=device-width, shrink-to-fit=no"/><meta data-react-helmet="true" name="title" content="Safely testing unofficial 3ds servers"/><meta data-react-helmet="true" name="description" content="Patching the 3ds to mitigate the risk when using unofficial 3ds game servers"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:title" content="Safely testing unofficial 3ds servers"/><meta data-react-helmet="true" property="og:description" content="Patching the 3ds to mitigate the risk when using unofficial 3ds game servers"/><meta data-react-helmet="true" property="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" property="twitter:title" content="Safely testing unofficial 3ds servers"/><meta data-react-helmet="true" property="twitter:description" content="Patching the 3ds to mitigate the risk when using unofficial 3ds game servers"/><style id="jss-server-side">html{box-sizing:border-box;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}*,::after,::before{box-sizing:inherit}b,strong{font-weight:bolder}body{color:rgba(0,0,0,.87);margin:0;font-size:.875rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.43;letter-spacing:.01071em;background-color:#fafafa}@media print{body{background-color:#fff}}body::-webkit-backdrop{background-color:#fafafa}body::backdrop{background-color:#fafafa}.MuiTypography-root{margin:0}.MuiTypography-body2{font-size:.875rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.43;letter-spacing:.01071em}.MuiTypography-body1{font-size:1rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.5;letter-spacing:.00938em}.MuiTypography-caption{font-size:.75rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.66;letter-spacing:.03333em}.MuiTypography-button{font-size:.875rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:500;line-height:1.75;letter-spacing:.02857em;text-transform:uppercase}.MuiTypography-h1{font-size:6rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:300;line-height:1.167;letter-spacing:-.01562em}.MuiTypography-h2{font-size:3.75rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:300;line-height:1.2;letter-spacing:-.00833em}.MuiTypography-h3{font-size:3rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.167;letter-spacing:0}.MuiTypography-h4{font-size:2.125rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.235;letter-spacing:.00735em}.MuiTypography-h5{font-size:1.5rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.334;letter-spacing:0}.MuiTypography-h6{font-size:1.25rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:500;line-height:1.6;letter-spacing:.0075em}.MuiTypography-subtitle1{font-size:1rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.75;letter-spacing:.00938em}.MuiTypography-subtitle2{font-size:.875rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:500;line-height:1.57;letter-spacing:.00714em}.MuiTypography-overline{font-size:.75rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:2.66;letter-spacing:.08333em;text-transform:uppercase}.MuiTypography-srOnly{width:1px;height:1px;overflow:hidden;position:absolute}.MuiTypography-alignLeft{text-align:left}.MuiTypography-alignCenter{text-align:center}.MuiTypography-alignRight{text-align:right}.MuiTypography-alignJustify{text-align:justify}.MuiTypography-noWrap{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.MuiTypography-gutterBottom{margin-bottom:.35em}.MuiTypography-paragraph{margin-bottom:16px}.MuiTypography-colorInherit{color:inherit}.MuiTypography-colorPrimary{color:#025d94}.MuiTypography-colorSecondary{color:#f50057}.MuiTypography-colorTextPrimary{color:rgba(0,0,0,.87)}.MuiTypography-colorTextSecondary{color:rgba(0,0,0,.54)}.MuiTypography-colorError{color:#f44336}.MuiTypography-displayInline{display:inline}.MuiTypography-displayBlock{display:block}.MuiButtonBase-root{color:inherit;border:0;cursor:pointer;margin:0;display:-webkit-inline-box;display:inline-flex;outline:0;padding:0;position:relative;-webkit-box-align:center;align-items:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;border-radius:0;vertical-align:middle;-moz-appearance:none;-webkit-box-pack:center;justify-content:center;text-decoration:none;background-color:transparent;-webkit-appearance:none;-webkit-tap-highlight-color:transparent}.MuiButtonBase-root::-moz-focus-inner{border-style:none}.MuiButtonBase-root.Mui-disabled{cursor:default;pointer-events:none}.MuiPaper-root{color:rgba(0,0,0,.87);-webkit-transition:box-shadow .3s cubic-bezier(.4,0,.2,1) 0s;transition:box-shadow .3s cubic-bezier(.4,0,.2,1) 0s;background-color:#fff}.MuiPaper-rounded{border-radius:4px}.MuiPaper-outlined{border:1px solid rgba(0,0,0,.12)}.MuiPaper-elevation0{box-shadow:none}.MuiPaper-elevation1{box-shadow:0 2px 1px -1px rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 1px 3px 0 rgba(0,0,0,.12)}.MuiPaper-elevation2{box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12)}.MuiPaper-elevation3{box-shadow:0 3px 3px -2px rgba(0,0,0,.2),0 3px 4px 0 rgba(0,0,0,.14),0 1px 8px 0 rgba(0,0,0,.12)}.MuiPaper-elevation4{box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12)}.MuiPaper-elevation5{box-shadow:0 3px 5px -1px rgba(0,0,0,.2),0 5px 8px 0 rgba(0,0,0,.14),0 1px 14px 0 rgba(0,0,0,.12)}.MuiPaper-elevation6{box-shadow:0 3px 5px -1px rgba(0,0,0,.2),0 6px 10px 0 rgba(0,0,0,.14),0 1px 18px 0 rgba(0,0,0,.12)}.MuiPaper-elevation7{box-shadow:0 4px 5px -2px rgba(0,0,0,.2),0 7px 10px 1px rgba(0,0,0,.14),0 2px 16px 1px rgba(0,0,0,.12)}.MuiPaper-elevation8{box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.MuiPaper-elevation9{box-shadow:0 5px 6px -3px rgba(0,0,0,.2),0 9px 12px 1px rgba(0,0,0,.14),0 3px 16px 2px rgba(0,0,0,.12)}.MuiPaper-elevation10{box-shadow:0 6px 6px -3px rgba(0,0,0,.2),0 10px 14px 1px rgba(0,0,0,.14),0 4px 18px 3px rgba(0,0,0,.12)}.MuiPaper-elevation11{box-shadow:0 6px 7px -4px rgba(0,0,0,.2),0 11px 15px 1px rgba(0,0,0,.14),0 4px 20px 3px rgba(0,0,0,.12)}.MuiPaper-elevation12{box-shadow:0 7px 8px -4px rgba(0,0,0,.2),0 12px 17px 2px rgba(0,0,0,.14),0 5px 22px 4px rgba(0,0,0,.12)}.MuiPaper-elevation13{box-shadow:0 7px 8px -4px rgba(0,0,0,.2),0 13px 19px 2px rgba(0,0,0,.14),0 5px 24px 4px rgba(0,0,0,.12)}.MuiPaper-elevation14{box-shadow:0 7px 9px -4px rgba(0,0,0,.2),0 14px 21px 2px rgba(0,0,0,.14),0 5px 26px 4px rgba(0,0,0,.12)}.MuiPaper-elevation15{box-shadow:0 8px 9px -5px rgba(0,0,0,.2),0 15px 22px 2px rgba(0,0,0,.14),0 6px 28px 5px rgba(0,0,0,.12)}.MuiPaper-elevation16{box-shadow:0 8px 10px -5px rgba(0,0,0,.2),0 16px 24px 2px rgba(0,0,0,.14),0 6px 30px 5px rgba(0,0,0,.12)}.MuiPaper-elevation17{box-shadow:0 8px 11px -5px rgba(0,0,0,.2),0 17px 26px 2px rgba(0,0,0,.14),0 6px 32px 5px rgba(0,0,0,.12)}.MuiPaper-elevation18{box-shadow:0 9px 11px -5px rgba(0,0,0,.2),0 18px 28px 2px rgba(0,0,0,.14),0 7px 34px 6px rgba(0,0,0,.12)}.MuiPaper-elevation19{box-shadow:0 9px 12px -6px rgba(0,0,0,.2),0 19px 29px 2px rgba(0,0,0,.14),0 7px 36px 6px rgba(0,0,0,.12)}.MuiPaper-elevation20{box-shadow:0 10px 13px -6px rgba(0,0,0,.2),0 20px 31px 3px rgba(0,0,0,.14),0 8px 38px 7px rgba(0,0,0,.12)}.MuiPaper-elevation21{box-shadow:0 10px 13px -6px rgba(0,0,0,.2),0 21px 33px 3px rgba(0,0,0,.14),0 8px 40px 7px rgba(0,0,0,.12)}.MuiPaper-elevation22{box-shadow:0 10px 14px -6px rgba(0,0,0,.2),0 22px 35px 3px rgba(0,0,0,.14),0 8px 42px 7px rgba(0,0,0,.12)}.MuiPaper-elevation23{box-shadow:0 11px 14px -7px rgba(0,0,0,.2),0 23px 36px 3px rgba(0,0,0,.14),0 9px 44px 8px rgba(0,0,0,.12)}.MuiPaper-elevation24{box-shadow:0 11px 15px -7px rgba(0,0,0,.2),0 24px 38px 3px rgba(0,0,0,.14),0 9px 46px 8px rgba(0,0,0,.12)}.MuiDrawer-docked{-webkit-box-flex:0;flex:0 0 auto}.MuiDrawer-paper{top:0;-webkit-box-flex:1;flex:1 0 auto;height:100%;display:-webkit-box;display:flex;outline:0;z-index:1200;position:fixed;overflow-y:auto;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-overflow-scrolling:touch}.MuiDrawer-paperAnchorLeft{left:0;right:auto}.MuiDrawer-paperAnchorRight{left:auto;right:0}.MuiDrawer-paperAnchorTop{top:0;left:0;right:0;bottom:auto;height:auto;max-height:100%}.MuiDrawer-paperAnchorBottom{top:auto;left:0;right:0;bottom:0;height:auto;max-height:100%}.MuiDrawer-paperAnchorDockedLeft{border-right:1px solid rgba(0,0,0,.12)}.MuiDrawer-paperAnchorDockedTop{border-bottom:1px solid rgba(0,0,0,.12)}.MuiDrawer-paperAnchorDockedRight{border-left:1px solid rgba(0,0,0,.12)}.MuiDrawer-paperAnchorDockedBottom{border-top:1px solid rgba(0,0,0,.12)}.MuiToolbar-root{display:-webkit-box;display:flex;position:relative;-webkit-box-align:center;align-items:center}.MuiToolbar-gutters{padding-left:16px;padding-right:16px}@media (min-width:600px){.MuiToolbar-gutters{padding-left:24px;padding-right:24px}}.MuiToolbar-regular{min-height:56px}@media (min-width:0px) and (orientation:landscape){.MuiToolbar-regular{min-height:48px}}@media (min-width:600px){.MuiToolbar-regular{min-height:64px}}.MuiToolbar-dense{min-height:48px}.jss101{width:250px}.jss102{margin-top:8px;margin-bottom:8px}.MuiAppBar-root{width:100%;display:-webkit-box;display:flex;z-index:1100;box-sizing:border-box;flex-shrink:0;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.MuiAppBar-positionFixed{top:0;left:auto;right:0;position:fixed}@media print{.MuiAppBar-positionFixed{position:absolute}}.MuiAppBar-positionAbsolute{top:0;left:auto;right:0;position:absolute}.MuiAppBar-positionSticky{top:0;left:auto;right:0;position:-webkit-sticky;position:sticky}.MuiAppBar-positionStatic{position:static;-webkit-transform:translateZ(0);transform:translateZ(0)}.MuiAppBar-positionRelative{position:relative}.MuiAppBar-colorDefault{color:rgba(0,0,0,.87);background-color:#f5f5f5}.MuiAppBar-colorPrimary{color:#fff;background-color:#025d94}.MuiAppBar-colorSecondary{color:#fff;background-color:#f50057}.MuiSvgIcon-root{fill:currentColor;width:1em;height:1em;display:inline-block;font-size:1.5rem;-webkit-transition:fill .2s cubic-bezier(.4,0,.2,1) 0s;transition:fill .2s cubic-bezier(.4,0,.2,1) 0s;flex-shrink:0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.MuiSvgIcon-colorPrimary{color:#025d94}.MuiSvgIcon-colorSecondary{color:#f50057}.MuiSvgIcon-colorAction{color:rgba(0,0,0,.54)}.MuiSvgIcon-colorError{color:#f44336}.MuiSvgIcon-colorDisabled{color:rgba(0,0,0,.26)}.MuiSvgIcon-fontSizeInherit{font-size:inherit}.MuiSvgIcon-fontSizeSmall{font-size:1.25rem}.MuiSvgIcon-fontSizeLarge{font-size:2.1875rem}.MuiIconButton-root{-webkit-box-flex:0;flex:0 0 auto;color:rgba(0,0,0,.54);padding:12px;overflow:visible;font-size:1.5rem;text-align:center;-webkit-transition:background-color 150ms cubic-bezier(.4,0,.2,1) 0s;transition:background-color 150ms cubic-bezier(.4,0,.2,1) 0s;border-radius:50%}.MuiIconButton-root:hover{background-color:rgba(0,0,0,.04)}.MuiIconButton-root.Mui-disabled{color:rgba(0,0,0,.26);background-color:transparent}@media (hover:none){.MuiIconButton-root:hover{background-color:transparent}}.MuiIconButton-edgeStart{margin-left:-12px}.MuiIconButton-sizeSmall.MuiIconButton-edgeStart{margin-left:-3px}.MuiIconButton-edgeEnd{margin-right:-12px}.MuiIconButton-sizeSmall.MuiIconButton-edgeEnd{margin-right:-3px}.MuiIconButton-colorInherit{color:inherit}.MuiIconButton-colorPrimary{color:#025d94}.MuiIconButton-colorPrimary:hover{background-color:rgba(2,93,148,.04)}@media (hover:none){.MuiIconButton-colorPrimary:hover{background-color:transparent}}.MuiIconButton-colorSecondary{color:#f50057}.MuiIconButton-colorSecondary:hover{background-color:rgba(245,0,87,.04)}@media (hover:none){.MuiIconButton-colorSecondary:hover{background-color:transparent}}.MuiIconButton-sizeSmall{padding:3px;font-size:1.125rem}.MuiIconButton-label{width:100%;display:-webkit-box;display:flex;-webkit-box-align:inherit;align-items:inherit;-webkit-box-pack:inherit;justify-content:inherit}.jss6{z-index:1301}.jss7{padding-left:12px;padding-right:8px}.jss8{margin-right:12px}.jss131{color:#fff;height:3rem;display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;background-color:#025d94}.jss132{color:#fff;background-color:#347da9}.jss133{background-color:#025d94}.jss134{display:-webkit-box;display:flex;-webkit-box-pack:center;justify-content:center}.jss135{width:initial}.jss2{display:-webkit-box;display:flex;min-height:100vh;-webkit-box-align:stretch;align-items:stretch;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-box-pack:center;justify-content:center}.jss3{-webkit-box-flex:1;flex-grow:1;margin-top:128px;margin-left:24px;margin-right:24px;margin-bottom:40px}@media (min-width:960px){.jss3{max-width:720px;margin-left:auto;margin-right:auto}}@media (min-width:960px){.jss4{width:75%;-webkit-transition:margin 195ms cubic-bezier(.4,0,.6,1) 0s,width 195ms cubic-bezier(.4,0,.6,1) 0s;transition:margin 195ms cubic-bezier(.4,0,.6,1) 0s,width 195ms cubic-bezier(.4,0,.6,1) 0s}}@media (min-width:960px){.jss5{width:calc(75% - 4rem - 240px);-webkit-transition:margin 225ms cubic-bezier(0,0,.2,1) 0s,width 225ms cubic-bezier(0,0,.2,1) 0s;transition:margin 225ms cubic-bezier(0,0,.2,1) 0s,width 225ms cubic-bezier(0,0,.2,1) 0s;margin-left:auto}}.MuiLink-underlineNone{text-decoration:none}.MuiLink-underlineHover{text-decoration:none}.MuiLink-underlineHover:hover{text-decoration:underline}.MuiLink-underlineAlways{text-decoration:underline}.MuiLink-button{border:0;cursor:pointer;margin:0;outline:0;padding:0;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;border-radius:0;vertical-align:middle;-moz-appearance:none;background-color:transparent;-webkit-appearance:none;-webkit-tap-highlight-color:transparent}.MuiLink-button::-moz-focus-inner{border-style:none}.MuiLink-button.Mui-focusVisible{outline:auto}.jss115{margin-bottom:40px}.jss116{margin-top:56px;margin-bottom:24px}.jss117{margin-top:16px}.jss118{overflow:auto;margin-top:32px;margin-bottom:32px;background-color:#1e1e1e}.jss119{float:left;padding:16px}.jss120{margin-top:4.8px;margin-left:0;margin-right:0;margin-bottom:16px;list-style-type:disc}.jss121{margin-top:0;margin-left:0;margin-right:0;margin-bottom:4.8px}.jss122{margin-bottom:16px}.jss123{color:#9600b9}.jss124{width:100%;margin-top:32px;margin-bottom:32px}.jss1{margin-bottom:16px}</style><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/ZaksBlog/static/webfonts/s/roboto/v20/KFOlCnqEu92Fr1MmSU5fBBc4.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/ZaksBlog/static/webfonts/s/roboto/v20/KFOmCnqEu92Fr1Mu4mxK.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/ZaksBlog/static/webfonts/s/roboto/v20/KFOlCnqEu92Fr1MmEU9fBBc4.woff2"/><style>@font-face{font-family:Roboto;font-style:normal;font-weight:300;src:url(/ZaksBlog/static/webfonts/s/roboto/v20/KFOlCnqEu92Fr1MmSU5fBBc4.woff2) format("woff2");font-display:swap}@font-face{font-family:Roboto;font-style:normal;font-weight:400;src:url(/ZaksBlog/static/webfonts/s/roboto/v20/KFOmCnqEu92Fr1Mu4mxK.woff2) format("woff2");font-display:swap}@font-face{font-family:Roboto;font-style:normal;font-weight:500;src:url(/ZaksBlog/static/webfonts/s/roboto/v20/KFOlCnqEu92Fr1MmEU9fBBc4.woff2) format("woff2");font-display:swap}@font-face{font-family:Roboto;font-style:normal;font-weight:300;src:url(/ZaksBlog/static/webfonts/s/roboto/v20/KFOlCnqEu92Fr1MmSU5fBBc-.woff) format("woff");font-display:swap}@font-face{font-family:Roboto;font-style:normal;font-weight:400;src:url(/ZaksBlog/static/webfonts/s/roboto/v20/KFOmCnqEu92Fr1Mu4mxM.woff) format("woff");font-display:swap}@font-face{font-family:Roboto;font-style:normal;font-weight:500;src:url(/ZaksBlog/static/webfonts/s/roboto/v20/KFOlCnqEu92Fr1MmEU9fBBc-.woff) format("woff");font-display:swap}</style><link as="script" rel="preload" href="/ZaksBlog/webpack-runtime-b3731414f718f59aca02.js"/><link as="script" rel="preload" href="/ZaksBlog/app-1c9b5a5601628d202f7c.js"/><link as="script" rel="preload" href="/ZaksBlog/styles-643a86ed2cc14ceeaaf5.js"/><link as="script" rel="preload" href="/ZaksBlog/commons-7ab0593a066eeeac61a6.js"/><link as="script" rel="preload" href="/ZaksBlog/component---src-pages-safely-testing-unofficial-3-ds-servers-index-mdx-5fc2bd97300a220950b7.js"/><link as="fetch" rel="preload" href="/ZaksBlog/page-data/safely-testing-unofficial-3ds-servers/page-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div class="jss2"><header class="MuiPaper-root MuiAppBar-root MuiAppBar-positionFixed jss6 MuiAppBar-colorPrimary mui-fixed MuiPaper-elevation0"><div class="MuiToolbar-root MuiToolbar-regular jss7 MuiToolbar-gutters"><button class="MuiButtonBase-root MuiIconButton-root jss8 MuiIconButton-colorInherit" tabindex="0" type="button" aria-label="Open drawer"><span class="MuiIconButton-label"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true" role="presentation"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg></span></button><h1 class="MuiTypography-root MuiTypography-h6 MuiTypography-colorInherit">Zak‘s Blog</h1></div></header><main class="jss3 jss4"><h6 class="MuiTypography-root jss1 MuiTypography-subtitle2">February 18, 2021</h6><h1 class="MuiTypography-root jss115 MuiTypography-h3">Safely testing unofficial 3ds servers</h1><p class="MuiTypography-root jss122 MuiTypography-body1">(This post was edited on February 20, 2021 after I looked into FRD more and found the original auth flow was incorrect.)</p><p class="MuiTypography-root jss122 MuiTypography-body1">The 3ds is no longer being manufactored and is at the end of its life, which means there&#x27;s a high chance servers used by 3ds games to play online will be taken down at some point in the next few years. For preservation purposes and being able to enjoy past games, this is a good chance to start recreating online functionality for games.</p><p class="MuiTypography-root jss122 MuiTypography-body1">There are groups and people, such as <a class="MuiTypography-root MuiLink-root MuiLink-underlineHover jss123 MuiTypography-colorPrimary" href="https://github.com/PretendoNetwork/">Pretendo</a> and <a class="MuiTypography-root MuiLink-root MuiLink-underlineHover jss123 MuiTypography-colorPrimary" href="https://github.com/kinnay/">Kinnay</a>, who are working to accomplish such a task.</p><p class="MuiTypography-root jss122 MuiTypography-body1">With a huge thanks to <a class="MuiTypography-root MuiLink-root MuiLink-underlineHover jss123 MuiTypography-colorPrimary" href="https://github.com/kinnay/NintendoClients/wiki">documentation written by Kinnay</a> and <a class="MuiTypography-root MuiLink-root MuiLink-underlineHover jss123 MuiTypography-colorPrimary" href="https://github.com/Stary2001/nex-dissector">Stary2001&#x27;s nex-dissector</a>, I was able to recreate Pokemon&#x27;s Gen 7 GTS services a few years ago. The Gen 7 games rely on the 3ds friend services in order to play online, so I also recreated those as well.</p><p class="MuiTypography-root jss122 MuiTypography-body1">My initial attempt was partially to learn about the 3ds online services and partially to get something working, but I had intentions of rewriting it in the future. Originally, I wrote everything myself from the ground up to learn about the tiniest details of the 3ds online services. Recently, I started the rewrite using Kinnay&#x27;s <a class="MuiTypography-root MuiLink-root MuiLink-underlineHover jss123 MuiTypography-colorPrimary" href="https://github.com/kinnay/NintendoClients">NintendoClients library</a>; it&#x27;s well maintained, easy to use, and has had many features and improvements over the past several years.</p><p class="MuiTypography-root jss122 MuiTypography-body1">Testing my servers locally has been fine, but there were a few problems before I could ask other people to help test.</p><h2 class="MuiTypography-root jss116 MuiTypography-h4 MuiTypography-gutterBottom">Problems with public testing</h2><p class="MuiTypography-root jss122 MuiTypography-body1">The first problem is related to the friend services. As previously mentioned, 3ds games tend to rely on the friend services when going online. While I recreated functionality, it&#x27;s super easy for the 3ds to get desynchronized from the official servers (e.g. different lists of friends), which is not good. As long as the official friend services are up, it&#x27;s better for consoles to use those over unofficial solutions.</p><p class="MuiTypography-root jss122 MuiTypography-body1">The second problem is related to authentication. Authentication is how a user proves their identity to a server so only they can log in with their account. Each game has a pair of servers related to its online play: an authentication server and a game server. In order to locate the auth server, the 3ds talks to a server called NASC.</p><p class="MuiTypography-root jss122 MuiTypography-body1">This is a very rough flow of how a 3ds game connects to its game servers:</p><ol><li class="MuiTypography-root jss121 MuiTypography-body1">The 3ds asks the NASC server for the game&#x27;s auth server IP address</li><li class="MuiTypography-root jss121 MuiTypography-body1">The NASC server responds with the IP address of the auth server</li><li class="MuiTypography-root jss121 MuiTypography-body1">The 3ds authenticates with the auth server using a hidden user password, among other things</li><li class="MuiTypography-root jss121 MuiTypography-body1">The auth server responds with the IP address of the game server and a session token</li><li class="MuiTypography-root jss121 MuiTypography-body1">The 3ds starts communicating with the game server using the session token</li></ol><p class="MuiTypography-root jss122 MuiTypography-body1">There&#x27;s a bit more going on, but that&#x27;s the general idea.</p><p class="MuiTypography-root jss122 MuiTypography-body1">Step 3 poses a problem. Every 3ds user has a hidden password that is used to go online. If someone wants to connect to one of my unofficial servers, or a server made by another developer, they would need to provide their password so the unofficial auth server knows the password the 3ds will try to use.</p><p class="MuiTypography-root jss122 MuiTypography-body1">It&#x27;s a big security issue to disclose any password to someone. With the 3ds online services still operating, the password could be used in malicious ways.</p><p class="MuiTypography-root jss122 MuiTypography-body1">A smaller issue is the bad user experience of having to run some sort of homebrew or script to extract a console password and do something with it before being able to go online.</p><p class="MuiTypography-root jss122 MuiTypography-body1">There were other issues, but those two were at the top of my mind.</p><p class="MuiTypography-root jss122 MuiTypography-body1">I was left with two problems to solve:</p><ul class="MuiTypography-root jss120 MuiTypography-body1"><li class="MuiTypography-root jss121 MuiTypography-body1">The 3ds should use the official servers for friend services and unofficial servers for games</li><li class="MuiTypography-root jss121 MuiTypography-body1">The 3ds should use the real password for friend services and a fake password for games</li></ul><p class="MuiTypography-root jss122 MuiTypography-body1">Since the NASC server locates the game&#x27;s auth server, and the auth server locates the actual server used to play online, I needed to make sure a 3ds would communicate with my custom NASC server, and everything else would fall into place.</p><h2 class="MuiTypography-root jss116 MuiTypography-h4 MuiTypography-gutterBottom">Finding a patch target</h2><p class="MuiTypography-root jss122 MuiTypography-body1">The 3ds operating system is broken into several system modules, similar to a microservice architecture. FRD is the system module responsible for friend services.</p><p class="MuiTypography-root jss122 MuiTypography-body1">A while ago I looked at <a class="MuiTypography-root MuiLink-root MuiLink-underlineHover jss123 MuiTypography-colorPrimary" href="https://www.3dbrew.org/wiki/FRD_Savegame">3dbrew&#x27;s FRD savegame documentation</a> and noticed the save includes the user&#x27;s password for going online.</p><p class="MuiTypography-root jss122 MuiTypography-body1">Games shouldn&#x27;t have access to the user&#x27;s password, as that would be a security concern, and the password isn&#x27;t likely to be copied between different system modules since that would be a larger attack surface, so I figured FRD must be solely responsible for talking with the auth servers for every game.</p><p class="MuiTypography-root jss122 MuiTypography-body1">I looked into how the Gen 7 Pokemon games interact with FRD to go online and found out this was roughly the flow:</p><ol><li class="MuiTypography-root jss121 MuiTypography-body1">The game asks FRD for the game&#x27;s auth server IP address, and the request is forwarded to NASC</li><li class="MuiTypography-root jss121 MuiTypography-body1">NASC responds with the auth server&#x27;s IP address, which is forwarded to the game</li><li class="MuiTypography-root jss121 MuiTypography-body1">The game asks FRD for the user&#x27;s password</li><li class="MuiTypography-root jss121 MuiTypography-body1">FRD responds with the user&#x27;s password</li><li class="MuiTypography-root jss121 MuiTypography-body1">The game authenticates with the auth server and goes online</li></ol><p class="MuiTypography-root jss122 MuiTypography-body1">This was a bummer to find out. If Nintendo owned the auth servers, then at worst a rogue developer or other security issue could only put tokens valid for a single session of a single game at risk. In this way, Nintendo wouldn&#x27;t need to trust game developers in order for them to build online functionality.</p><p class="MuiTypography-root jss122 MuiTypography-body1">But it turns out that was not the case: games access the password directly.</p><p class="MuiTypography-root jss122 MuiTypography-body1">Regardless, this was important for two reasons:</p><ul class="MuiTypography-root jss120 MuiTypography-body1"><li class="MuiTypography-root jss121 MuiTypography-body1">FRD is responsible for NASC server communications</li><li class="MuiTypography-root jss121 MuiTypography-body1">FRD is the owner of user&#x27;s password</li></ul><p class="MuiTypography-root jss122 MuiTypography-body1">The solutions to both of my original problems could be solved by patching the FRD system module.</p><h2 class="MuiTypography-root jss116 MuiTypography-h4 MuiTypography-gutterBottom">Official friend servers and unofficial game servers</h2><p class="MuiTypography-root jss122 MuiTypography-body1">I dumped the FRD system module and opened it in Ghidra. When it loaded, I searched for the string <code>nasc</code> and had three results show up: prod, test, and dev urls.</p><p class="MuiTypography-root jss122 MuiTypography-body1">All three of them were used in the same function that looked very roughly like this:</p><div class="MuiPaper-root jss118 MuiPaper-elevation4 MuiPaper-rounded"><div class="jss119"><pre class="prism-code language-cpp" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">SOME_FUNCTION</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">char</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> param_0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">int</span><span class="token plain"> param_1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">param_1 </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">param_0 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> NASC_PROD_URL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">param_1 </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">param_0 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> NASC_TEST_URL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">param_1 </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">param_0 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> NASC_DEV_URL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span></div></pre></div></div><p class="MuiTypography-root jss122 MuiTypography-body1">After a little cleaning:</p><div class="MuiPaper-root jss118 MuiPaper-elevation4 MuiPaper-rounded"><div class="jss119"><pre class="prism-code language-cpp" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">enum</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Environment</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  PROD</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  TEST</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  DEV</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">getNascUrl</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">char</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> url</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> Environment environment</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">environment </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> Environment</span><span class="token operator" style="color:rgb(212, 212, 212)">::</span><span class="token plain">PROD</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">url </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> NASC_PROD_URL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">environment </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> Environment</span><span class="token operator" style="color:rgb(212, 212, 212)">::</span><span class="token plain">TEST</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">url </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> NASC_TEST_URL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">environment </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> Environment</span><span class="token operator" style="color:rgb(212, 212, 212)">::</span><span class="token plain">DEV</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">url </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> NASC_DEV_URL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span></div></pre></div></div><p class="MuiTypography-root jss122 MuiTypography-body1">The production servers are used for regular users, and the test and dev environments are used to test and develop game servers.</p><p class="MuiTypography-root jss122 MuiTypography-body1">The function responsible for getting the NASC url was referenced in a few locations. If the friend services and games used the same code to get the NASC urls, it would make sense for the function to only be used in one location. Since the function was used in multiple locations, it made sense for the friend services to ask for the NASC url in a different place in the code than game servers.</p><p class="MuiTypography-root jss122 MuiTypography-body1"><a class="MuiTypography-root MuiLink-root MuiLink-underlineHover jss123 MuiTypography-colorPrimary" href="https://github.com/LumaTeam/Luma3DS">Luma3ds (the 3ds custom firmware)</a> allows debugging 3ds software with GDB, so I conntected GDB to the FRD system module and set a breakpoint at the function. Afterwards, I went online with the friends applet and a Pokemon game to see which location of the code was responsible for getting the NASC url for the friend services and games.</p><p class="MuiTypography-root jss122 MuiTypography-body1">Indeed, they were different locations. I patched the code that gets the NASC url for game servers to use the test environment, instead of production. Then I patched the NASC test url to be a url that points to a server I control.</p><p class="MuiTypography-root jss122 MuiTypography-body1">When I went online, my 3ds connected to the official friend servers and my unofficial Pokemon servers.</p><h2 class="MuiTypography-root jss116 MuiTypography-h4 MuiTypography-gutterBottom">Using a fake password</h2><p class="MuiTypography-root jss122 MuiTypography-body1">The functions that use the <code>getNascUrl</code> function set up the HTTP request and call other functions to set up the request headers and body.</p><p class="MuiTypography-root jss122 MuiTypography-body1">Having already built a NASC server based on sniffing traffic from my 3ds to the official NASC server, I was fairly familiar with the content in the request body. However there was one part I hadn&#x27;t seen before: the request body would conditionally send the user password, which isn&#x27;t behavior I had observed.</p><p class="MuiTypography-root jss122 MuiTypography-body1">Incredibly roughly:</p><div class="MuiPaper-root jss118 MuiPaper-elevation4 MuiPaper-rounded"><div class="jss119"><pre class="prism-code language-cpp" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">setNascBody</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token comment" style="color:rgb(106, 153, 85)">/* args */</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Add the normal fields to the request body</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">doesNotHaveUserId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">getData</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">setField</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;passwd&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Set user Id and uid hmac</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span></div></pre></div></div><p class="MuiTypography-root jss122 MuiTypography-body1">If the user does not have a user Id, it sends the password in the nasc request, otherwise it sends the user Id. I didn&#x27;t look into that behavior much, but I imagine that&#x27;s for development and testing purposes.</p><p class="MuiTypography-root jss122 MuiTypography-body1">This was a great find because I didn&#x27;t have to go digging for a place in FRD that uses the password.</p><p class="MuiTypography-root jss122 MuiTypography-body1">I set a breakpoint at the instruction checking for a user Id and forced the condition to be true when the breakpoint was hit. I was able to confirm the value truly was the password used to connect online and got the location of memory that held the password.</p><p class="MuiTypography-root jss122 MuiTypography-body1">I set a watchpoint at the location of memory holding the password to see when a routine accessed the password. When I went online in the Pokemon game, the watchpoint was hit, which gave me the routine responsible for using the password when games are connecting online. This was separate from the location used by the friend services.</p><p class="MuiTypography-root jss122 MuiTypography-body1">I wrote a quick patch for games to reference a static string built into the patch rather than using the user&#x27;s actual password. When I restarted my 3ds with the new patch, I connected to the official friend servers with my real password and my unofficial Pokemon servers with my fake password.</p><p class="MuiTypography-root jss122 MuiTypography-body1">Having a plaintext password stored in a patch file is an obvious security risk, but considering a console with custom firmware can easily get the user&#x27;s real password, there&#x27;s not much that could be done either way. It protects the user&#x27;s real password as best as possible while building and testing servers, which was the original goal.</p><h2 class="MuiTypography-root jss116 MuiTypography-h4 MuiTypography-gutterBottom">Running a fake NASC in the cloud</h2><p class="MuiTypography-root jss122 MuiTypography-body1">Building an unofficial server locally is great for quick iterations, but the eventual goal is to run the server in the cloud for public access.</p><p class="MuiTypography-root jss122 MuiTypography-body1">When reading through <a class="MuiTypography-root MuiLink-root MuiLink-underlineHover jss123 MuiTypography-colorPrimary" href="https://www.3dbrew.org/wiki/Friend_Services">3dbrew&#x27;s friend services documentation</a>, I found out FRD uses three root certificate authorities to verify the NASC server is a Nintendo server.</p><p class="MuiTypography-root jss122 MuiTypography-body1">I&#x27;m not going to go over how certificates work, just mention that they are used to verify the identity of an entity, such as a server. I highly recommend readers read up on how this works.</p><p class="MuiTypography-root jss122 MuiTypography-body1">Since my server is not an official Nintendo server, my server would be rejected by FRD unless I told FRD to use a root CA that can verify my server&#x27;s identity.</p><p class="MuiTypography-root jss122 MuiTypography-body1"><a class="MuiTypography-root MuiLink-root MuiLink-underlineHover jss123 MuiTypography-colorPrimary" href="https://github.com/devkitPro/libctru/">Libctru</a> is an open source library that reimplements much of an official library used for 3ds software development. Many of the functions found in libctru interact with system modules to do tasks, such as making HTTP requests by talking with the HTTP system module.</p><p class="MuiTypography-root jss122 MuiTypography-body1">While looking through libctru, I found a <a class="MuiTypography-root MuiLink-root MuiLink-underlineHover jss123 MuiTypography-colorPrimary" href="https://github.com/devkitPro/libctru/blob/0ed1f2beb22319c15714badcab7671fbf9c03377/libctru/source/services/httpc.c#L476-L490">function that adds a root CA</a> to a request.</p><p class="MuiTypography-root jss122 MuiTypography-body1">I found several functions in FRD that interact with the HTTP system module, but not one to add a custom root CA to a request. So I rewrote that function in my patch and had it use a root CA embedded within the patch.</p><p class="MuiTypography-root jss122 MuiTypography-body1">A well known issue with the 3ds is that it does not support TLS 1.2. Unfortunately that means a NASC server currently needs to support the broken TLS 1.1. Hopefully a patch or reimplementation of the 3ds HTTPS communications can address this in the future. For now, it&#x27;s something to be aware of when setting up a NASC server.</p><p class="MuiTypography-root jss122 MuiTypography-body1">The fastest way I thought to test this patch was to get a makeshift NASC server running in AWS (a cloud provider) by having an API Gateway serve a static file from an S3 bucket containing a NASC response (the same response can be used repeatedly without issue).</p><p class="MuiTypography-root jss122 MuiTypography-body1">I compiled my patch with the AWS root CA needed for the API Gateway, attempted to go online with Pokemon on my 3ds, and everything worked perfectly.</p><h2 class="MuiTypography-root jss116 MuiTypography-h4 MuiTypography-gutterBottom">Conclusion</h2><p class="MuiTypography-root jss122 MuiTypography-body1">I have a patch with the ability to use the official servers and real password for friend services, use unofficial servers and a fake password for games, and use TLS when communicating with the unofficial NASC (granted, it&#x27;s a broken version of TLS).</p><p class="MuiTypography-root jss122 MuiTypography-body1">The patch is built with <a class="MuiTypography-root MuiLink-root MuiLink-underlineHover jss123 MuiTypography-colorPrimary" href="https://github.com/Kingcom/armips">armips</a> and was designed for anyone building the patch to supply their own password, NASC url, and root CA. This should make it easy for any developer to build their own online systems, and have people test them safely.</p><p class="MuiTypography-root jss122 MuiTypography-body1">Ideally for public use, a website would exist where a user could download a unique patch to connect to unofficial servers.</p><p class="MuiTypography-root jss122 MuiTypography-body1">For better or for worse, an interesting side effect of the separation between auth servers and game servers is a potential central authority of unofficial 3ds accounts, and the central authority would not need to help maintain any game servers.</p><p class="MuiTypography-root jss122 MuiTypography-body1">For example, a group of people could maintain the auth infrastructure for unofficial game servers, and individual developers or groups not related to the auth team could create unofficial servers. This would make it easier for unofficial servers to be created since one team of people wouldn&#x27;t have to create and maintain everything themselves.</p><p class="MuiTypography-root jss122 MuiTypography-body1">Thank you for reading this. You can find <a class="MuiTypography-root MuiLink-root MuiLink-underlineHover jss123 MuiTypography-colorPrimary" href="https://github.com/zaksabeast/3ds-frd-unofficial-server-patch">the final patch here</a> if you&#x27;re interested to see how it works.</p><p class="MuiTypography-root jss122 MuiTypography-body1">If anyone has any comments or questions, feel free to make a post on my blog&#x27;s <a class="MuiTypography-root MuiLink-root MuiLink-underlineHover jss123 MuiTypography-colorPrimary" href="https://github.com/zaksabeast/ZaksBlog/discussions">discussion page</a>.</p></main><footer><div class="jss131"><p class="MuiTypography-root MuiTypography-body2 MuiTypography-alignCenter">© 2021 zaksabeast</p></div></footer></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/safely-testing-unofficial-3ds-servers/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-1c9b5a5601628d202f7c.js"],"component---src-pages-emulate-wishmaker-without-dolphin-index-mdx":["/component---src-pages-emulate-wishmaker-without-dolphin-index-mdx-afd56152c2fcf3947cc3.js"],"component---src-pages-gameboy-qr-backups-index-mdx":["/component---src-pages-gameboy-qr-backups-index-mdx-b329e27e84ce3915d1a1.js"],"component---src-pages-index-mdx":["/component---src-pages-index-mdx-88b9f23c4d95e759c51f.js"],"component---src-pages-portable-wishmaker-distributor-index-mdx":["/component---src-pages-portable-wishmaker-distributor-index-mdx-87370407c8c9021e2505.js"],"component---src-pages-safely-testing-unofficial-3-ds-servers-index-mdx":["/component---src-pages-safely-testing-unofficial-3-ds-servers-index-mdx-5fc2bd97300a220950b7.js"]};/*]]>*/</script><script src="/ZaksBlog/component---src-pages-safely-testing-unofficial-3-ds-servers-index-mdx-5fc2bd97300a220950b7.js" async=""></script><script src="/ZaksBlog/commons-7ab0593a066eeeac61a6.js" async=""></script><script src="/ZaksBlog/styles-643a86ed2cc14ceeaaf5.js" async=""></script><script src="/ZaksBlog/app-1c9b5a5601628d202f7c.js" async=""></script><script src="/ZaksBlog/webpack-runtime-b3731414f718f59aca02.js" async=""></script></body></html>